<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    </head>

    <body>
        <svg id="map"></svg>
        <script src="../../build/eurostatmap.js"></script>
        <script>
            const url = 'https://raw.githubusercontent.com/eurostat/eurostat-map.js/master/examples/ur/pop_change.csv'
            const n2jURL = 'https://raw.githubusercontent.com/eurostat/Nuts2json/master/pub/v2/'
            let countriesToShow = [
                'AT',
                'BE',
                'BG',
                'CY',
                'CZ',
                'DE',
                'DK',
                'EE',
                'EL',
                'ES',
                'FI',
                'FR',
                'HR',
                'HU',
                'IE',
                'IT',
                'LI',
                'LT',
                'LU',
                'LV',
                'MT',
                'NL',
                'PL',
                'PT',
                'RO',
                'SE',
                'SI',
                'SK',
                'IS',
                'CH',
                'NO',
                'LI',
                'ME',
                'AL',
                'MK',
                'RS',
            ]
            let data = {
                ES: 0,
                FR: ':',
                DE: 300,
                IT: 400,
                LI: 500,
                CZ: 600,
                CH: 700,
                UK: 800,
                NO: 900,
                NL: 1000,
                PO: 1100,
                RO: 1200,
                DE11: 1000,
                PL812: 100,
            }
            const map = eurostatmap
                .map('chbi')
                .nutsLvl('mixed')
                .classToFillStyle((i, j) => {
                    if (i == 0 && j == 2) return '#71a8df'
                    if (i == 1 && j == 2) return '#286eb4'
                    if (i == 2 && j == 2) return '#1e5388'
                    if (i == 0 && j == 1) return '#fddba2'
                    if (i == 1 && j == 1) return '#faa519'
                    if (i == 2 && j == 1) return '#c87e04'
                    if (i == 0 && j == 0) return '#9dd58a'
                    if (i == 1 && j == 0) return '#5fb441'
                    if (i == 2 && j == 0) return '#468631'
                    return 'gray'
                })
                .tooltip({
                    textFunction: function (rg, map) {
                        const buf = []
                        //region name
                        if (rg.properties.id) {
                            //name and code
                            buf.push('<b>' + rg.properties.na + '</b> (' + rg.properties.id + ') <br>')
                        } else {
                            //region name
                            buf.push('<b>' + rg.properties.na + '</b><br>')
                        }

                        //URT value
                        if (countriesToShow.includes(rg.properties.id[0] + rg.properties.id[1])) {
                            const data2 = map.statData('v2')
                            const sv2 = data2.get(rg.properties.id)
                            if (!sv2 || (sv2.value != 0 && !sv2.value)) buf.push(map.noDataText_)
                            else {
                                buf.push(
                                    sv2.value == 1
                                        ? 'Predominantly urban region'
                                        : sv2.value == 2
                                        ? 'Intermediate region'
                                        : 'Predominantly rural region'
                                )
                            }

                            buf.push('<br>')

                            //stat value
                            const sv1 = map.statData('v1').get(rg.properties.id)
                            if (!sv1 || (sv1.value != 0 && !sv1.value)) buf.push(map.noDataText_)
                            else {
                                buf.push(sv1.value)
                                //unit 1
                                const unit1 = map.statData('v1').unitText()
                                if (unit1) buf.push(' ' + unit1)
                            }
                        }

                        return buf.join('')
                    },
                })
                .legend({
                    boxFill: 'none',
                    label2: 'label2',
                    label1: 'label1',
                    breaks1: ['break1', 'break2', 'break3'],
                    breaks2: [' b 2', ' b 2', ' b 2'],
                    x: 5,
                    y: 120,
                    squareSize: 100,
                    labelFontSize: 12,
                })
                .nutsrgSelFillSty('yellow')
                .showSourceLink(false)
                .coastalMarginColor('lightgray')
                .insets('default')
                .callback(() => console.log('callback fired'))
            //.countriesToShow(countriesToShow)
            //.bordersToShow(['efta', 'eu', 'cc', 'co'])

            map.statData().setData(data)
            map.statData('v2').setData(data)
            map.updateClassification()
            map.updateStyle()

            map.build()
        </script>
    </body>
</html>
