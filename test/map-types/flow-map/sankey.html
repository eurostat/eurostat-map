<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <svg id="map"></svg>
    <script src="../../../build/eurostatmap.js"></script>

    <script>
        const exampleGraph = {
            nodes: [
                { id: 'FR', name: 'France' },
                { id: 'DE', name: 'Germany' },
                { id: 'IT' },
                { id: 'ES' },
                { id: 'BE' },
                { id: 'NL' },
                { id: 'CH' },
                { id: 'PL' },
                { id: 'PT' },
                { id: 'AT' },
                { id: 'CZ' },
            ],
            links: [
                { source: 'FR', target: 'DE', value: 82018369 },
                { source: 'FR', target: 'NL', value: 34453478 },
                { source: 'FR', target: 'IT', value: 49697198 },
                { source: 'FR', target: 'ES', value: 45422327 },
                { source: 'FR', target: 'BE', value: 43038180 },

                { source: 'FR', target: 'CH', value: 16164188 },
                { source: 'FR', target: 'PL', value: 12673336 },
                { source: 'FR', target: 'PT', value: 7178656 },
                { source: 'FR', target: 'AT', value: 6305366 },
                { source: 'FR', target: 'CZ', value: 5883790 },
                { source: 'ES', target: 'IT', value: 5883790 },


            ],
        }

        const fmtCompact = new Intl.NumberFormat('en', {
            notation: 'compact',
            compactDisplay: 'short', // "short" → 1.2K, "long" → 1.2 thousand
            maximumFractionDigits: 1
        });

        //  // total trade
        //`https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data/ext_tec10?format=json&lang=en&unit=THS_EUR&sizeclas=TOTAL&stk_flow=EXP&partner=${exporter.value}&time=2021&geoLevel=country`
        //[{"id":"DE","value":82018369.72,"name":"Germany"},{"id":"IT","value":49697198.92,"name":"Italy"},{"id":"ES","value":45422327.56,"name":"Spain"},{"id":"BE","value":43038180.93,"name":"Belgium"},{"id":"NL","value":34453478.99,"name":"Netherlands"},{"id":"CH","value":16164188.98,"name":"Switzerland"},{"id":"PL","value":12673336.04,"name":"Poland"},{"id":"PT","value":7178656.08,"name":"Portugal"},{"id":"AT","value":6305366.1,"name":"Austria"},{"id":"CZ","value":5883790.49,"name":"Czechia"},{"id":"IE","value":5287477.09,"name":"Ireland"},{"id":"RO","value":4460277.11,"name":"Romania"},{"id":"DK","value":3843262.72,"name":"Denmark"},{"id":"HU","value":3624585.56,"name":"Hungary"},{"id":"SK","value":3003919.1,"name":"Slovakia"},{"id":"LU","value":2206077.33,"name":"Luxembourg"},{"id":"SI","value":1538814.42,"name":"Slovenia"},{"id":"LT","value":737286.81,"name":"Lithuania"},{"id":"RS","value":602221.24,"name":"Serbia"},{"id":"IS","value":405879.59,"name":"Iceland"},{"id":"LV","value":374371.49,"name":"Latvia"},{"id":"HR","value":371224.02,"name":"Croatia"},{"id":"MT","value":160032.27,"name":"Malta"},{"id":"MK","value":71053.23,"name":"North Macedonia"},{"id":"CY","value":42471.05,"name":"Cyprus"},{"id":"BG","value":null,"name":"Bulgaria"},{"id":"EE","value":null,"name":"Estonia"},{"id":"EL","value":null,"name":"Greece"},{"id":"FR","value":null,"name":"France"},{"id":"FI","value":null,"name":"Finland"},{"id":"SE","value":null,"name":"Sweden"},{"id":"NO","value":null,"name":"Norway"},{"id":"UK","value":null,"name":"United Kingdom"},{"id":"BA","value":null,"name":"Bosnia and Herzegovina"},{"id":"TR","value":null,"name":"Türkiye"},{"id":"XK","value":null,"name":"Kosovo*"}]
        const map = eurostatmap
            .map('flow')
            .scale('60M')
            .title('Flow map')
            .subtitle('')
            .flowGraph(exampleGraph)

            .flowLineType('sankey')
            .flowMinWidth(6)
            .flowMaxWidth(20)
            .flowColor('#72bb6f')
            .flowOutlines(true)
            .flowArrows(false)
            .flowOpacity(0.8)
            .flowDonuts(false)
            .flowCurvatureSettings({
                gapX: 10,        // how far before/after node to begin/end curve
                padX: -20,         // horizontal clearance near node stems
                padY: 1,         // vertical collision detection padding
                bumpY: 5,        // extra height for hop
                curvature: 0.4   // 0..1; default sankey smoothness 
            })
            .flowOrder((a, b) => {
                //edge case: put FR>BE link on top of FR>DE
                if (a.link.target.id == 'BE' && b.link.target.id == 'DE') {
                    return a.link.target.id == 'BE' ? -1 : 1
                }
                // put FR>PL on top of the following links
                if (b.link.target.id == 'PL' && ['DE', 'ES', 'BE', 'NL'].includes(a.link.target.id)) {
                    return -1
                }

                // move CH up
                if (a.link.target.id == 'CH' && b.link.target.id == 'AT') {
                    return -1
                }
                // otherwise sort by otherY
                return a.otherY - b.otherY
            })
            .flowRegionColors(['#bbd7ee', '#c7e3c6']) // exporter, importers

            .labels({
                shadows: true,
                values: true,
                valuesFormatter: (value) => fmtCompact.format(value)
            })

            .nutsLevel(0)
            .legend({ x: 10, y: 120, title: 'Flow volume' })
            .drawCoastalMargin(false)
            .insets(false)
            .zoomExtent([1, 10])
            .build()
    </script>
</body>

</html>