<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>eurostat-map.js</title>
        <style>
            .em-tooltip {
                max-width: 300px !important;
            }
            .em-grid-shape {
                fill: none;
                stroke: #ccc !important;
                stroke-width: 1px;
            }
            .em-grid-text {
                transform: translate(0, -22px) !important;
            }
        </style>
    </head>
    <body>
        <label for="dataset">Select a theme:</label>
        <select id="dataset" name="dataset">
            <option value="tourism">Tourism</option>
            <option value="death" selected>Causes of death</option>
        </select>
        <br />
        <svg id="map"></svg>

        <script src="../../../../build/eurostatmap.js"></script>
        <script>
            const legendLabelFormatter = new Intl.NumberFormat('en-GB', { notation: 'compact', compactDisplay: 'short' }).format
            const configs = {
                death: {
                    title: 'Causes of death',
                    subtitle: '2022',
                    nutsLevel: 0,
                    sizeLegend: { title: 'Total deaths', titlePadding: 15 },
                    colorLegend: { title: 'Cause' },
                    data: {
                        stat: {
                            eurostatDatasetCode: 'hlth_cd_mro',
                            filters: { age: 'TOTAL', unit: 'NR', sex: 'T', resid: 'TOT_RESID' },
                            unitText: 'Deaths per 100k',
                        },
                        timeParameter: 'TIME',
                        times: [
                            '2022-01',
                            '2022-02',
                            '2022-03',
                            '2022-04',
                            '2022-05',
                            '2022-06',
                            '2022-07',
                            '2022-08',
                            '2022-09',
                            '2022-10',
                            '2022-11',
                            '2022-12',
                        ],
                        categoryParameter: 'ICD10',
                        categoryCodes: ['U071', 'C', 'I', 'J'],
                        categoryLabels: ['COVID-19', 'Cancer', 'Circulatory', 'Respiratory'],
                        categoryColors: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02'],
                        totalCode: 'TOTAL',
                    },
                },
                tourism: {
                    title: 'Tourism',
                    subtitle: 'Nights spent in tourist accommodation, 2022',
                    nutsLevel: 0,
                    sizeLegend: { title: 'Total nights spent', titlePadding: 15, values: [400000000, 1000000], labelFormatter: legendLabelFormatter },
                    colorLegend: { title: 'Country of residence' },
                    data: {
                        stat: {
                            eurostatDatasetCode: 'tour_occ_nim',
                            filters: { unit: 'NR', c_resid: 'TOTAL', nace_r2: 'I551-I553' },
                            unitText: 'Nights spent',
                        },
                        timeParameter: 'TIME',
                        times: [
                            '2022-01',
                            '2022-02',
                            '2022-03',
                            '2022-04',
                            '2022-05',
                            '2022-06',
                            '2022-07',
                            '2022-08',
                            '2022-09',
                            '2022-10',
                            '2022-11',
                            '2022-12',
                        ],
                        categoryParameter: 'c_resid',
                        categoryCodes: ['DOM', 'FOR'],
                        categoryLabels: ['Domestic', 'Foreign'],
                        categoryColors: ['#1b9e77', '#d95f02'],
                        totalCode: 'TOTAL',
                    },
                },
            }

            // Build the map dynamically
            function buildMap(dataset) {
                const config = configs[dataset]
                const map = eurostatmap
                    .map('coxcomb')
                    .width(800)
                    .height(800)
                    .gridCartogram(true)
                    .gridCartogramMargins({ top: 130, right: 100, bottom: 50, left: 0 })
                    .gridCartogramShape('hexagon')
                    .gridCartogramCellPadding(10)
                    .coxcombOffsets({ x: -30, y: -25 })
                    .title(config.title)
                    .subtitle(config.subtitle)
                    .scale('60M')
                    .nutsLevel(config.nutsLevel)
                    .statCoxcomb(config.data)
                    .coxcombMinRadius(20)
                    .coxcombMaxRadius(35)
                    .coxcombRings(false)
                    .transitionDuration(2000)
                    .legend({
                        x: 570,
                        y: 10,
                        boxOpacity: 1,
                        boxPadding: 7,
                        titleFontWeight: 'bold',
                        sizeLegend: config.sizeLegend,
                        colorLegend: config.colorLegend,
                    })
                    .zoomExtent([1, 10])
                map.build()
            }

            // Initial render
            let currentDataset = 'tourism'
            buildMap(currentDataset)

            // Rebuild on dropdown change
            document.getElementById('dataset').addEventListener('change', function (e) {
                currentDataset = e.target.value
                buildMap(currentDataset)
            })
        </script>
    </body>
</html>
