<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>eurostat-map.js</title>
    </head>

    <body>
        <div>
            <svg id="map"></svg>
        </div>

        <div>
            <svg id="legend" style="overflow: inherit"></svg>
        </div>

        <script src="../../../build/eurostatmap.js"></script>
        <script>
            // custom pattern function
            const getFillPatternDefinitionFun = function () {
                return function (svg, numberOfClasses) {
                    const ps = 5 // Pattern size
                    const smin = 1 // Minimum size
                    const smax = 5.5 // Maximum size

                    // Clear previous patterns
                    svg.selectAll('.estatmapPattern').remove()

                    // Create patterns for each class
                    for (let i = 0; i < numberOfClasses; i++) {
                        const si = smin + ((smax - smin) * i) / (numberOfClasses - 1) // Calculate size for each class
                        const lineWidth = i + 1 // Increase line width for each class

                        const patt = svg
                            .append('pattern')
                            .attr('class', 'estatmapPattern')
                            .attr('id', 'pattern_' + i)
                            .attr('x', '0')
                            .attr('y', '0')
                            .attr('width', ps)
                            .attr('height', ps)
                            .attr('patternUnits', 'userSpaceOnUse')

                        // Add a line pattern with increasing stroke-width
                        if (i < 3) {
                            // Assuming you want to limit it to 3 lines
                            patt.append('line')
                                .attr('x1', 0)
                                .attr('y1', 1)
                                .attr('x2', 1)
                                .attr('y2', 1)
                                .style('stroke', 'currentColor')
                                .style('stroke-width', lineWidth) // Progressive stroke width
                        } else {
                            // When the class number exceeds 2, use a different pattern (e.g., square)
                            patt.append('rect')
                                .attr('x', 0)
                                .attr('y', 0)
                                .attr('width', ps)
                                .attr('height', ps)
                                .style('stroke', 'none')
                                .style('fill', 'currentColor')
                        }
                    }
                }
            }
            let map = eurostatmap
                .map('choropleth')
                .width(900)
                .title('Population in Europe')
                .titleFontSize(40)
                .titleFill('#444')
                .scale('60M')
                .classificationMethod('threshold')
                .clnb(6)
                .filtersDefinitionFunction(getFillPatternDefinitionFun())
                .nutsbnStroke({ 0: '#777', 1: '#777', 2: '#777', 3: '#777', oth: '#444', co: '#777' })
                .nutsbnStrokeWidth({ 0: 1, 1: 0.2, 2: 0.2, 3: 0.2, oth: 1, co: 1 })
                .hoverColor('darkblue')
                .seaFillStyle('#e9e9e9')
                .coastalMarginColor('#777')
                .coastalMarginStdDev(10)
                .coastalMarginWidth(5)
                .graticuleStroke('#888')
                .tooltipShowFlags(false)
                .threshold([1, 3, 6, 7, 8, 9])
                .legend({
                    svgId: 'legend',
                    title: 'FIRST',
                    decimals: 0,
                    shapeHeight: 15,
                    shapeWidth: 25,
                    noData: false,
                    labelFormatter: function (val) {
                        let o = val.toLocaleString('en').replace(/,/gi, ' ')
                        return o
                    },
                })
                .nutsLevel('mixed')

            map.statData().setData({
                ES: 2000,
                FR: 3000,
                DE: 4000,
                HU: 5000,
                SE: 12000,
                UK: 4000,
                IT: 2000,
                RO: 7000,
                PL: 8000,
                HR: 9000,
                SK: 10000,
            })
            map.build()

            // update data, classification
            setTimeout(() => {
                map.threshold([1000, 9000]).filtersDefinitionFunction(
                    eurostatmap.getFillPatternDefinitionFun({
                        patternSize: 5,
                        shape: 'square',
                        bckColor: 'white',
                        symbColor: 'red',
                    })
                )
                map.updateClassification().updateStyle()
                map.legend({
                    title: 'SECOND',
                    labelFormatter: (val) => val.toLocaleString('en').replace(/,/gi, ' ,'),
                })

                //map.statData().setData({ ES: 2, FR: 3, DE: 4, HU: 5, SE:12, UK:4, IT:2,RO:7,PL:8,HR:9,SK:10 })
            }, 5000)
        </script>
    </body>
</html>
