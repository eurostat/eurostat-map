<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body style="font-family: sans-serif;">
    <h1>Map 7.1 - Population change</h1>
    <p>
        Average annual population change by urban–rural typology, 2015–2020<br>
        Note: Italy (except Sassari (ITG2D)) and Luxembourg, break in series.<br>
        Source: Eurostat (online data code: <a
            href="https://ec.europa.eu/eurostat/databrowser/bookmark/3e017c63-aa36-4ddb-9272-272c2055b8a6?lang=en">demo_r_gind3</a>)
    </p>

    <svg id="map"></svg>

    <script src="../../build/eurostatmap.js"></script>
    <script>

const url = "https://raw.githubusercontent.com/eurostat/eurostat-map.js/master/examples/ur/7_1.csv";
        //NUTS,perc,urt,class

        const map = eurostatmap
            .map("chbi")
            .scale("60M")
            .nutsLvl(3)
            .nutsYear(2021)
            .stat("v1", { csvURL: url, geoCol: "NUTS", valueCol: "perc", unitText: " %" })
            .stat("v2", { csvURL: url, geoCol: "NUTS", valueCol: "urt" })
            .clnb(3)
            .classifier1((v) => v >= 5.0 ? 2 : v >= -5 ? 1 : 0)
            .classifier2((v) => v - 1)
            .classToFillStyle((i, j) => {
                if (i == 0 && j == 0) return "#71a8df";
                if (i == 1 && j == 0) return "#286eb4";
                if (i == 2 && j == 0) return "#1e5388";
                if (i == 0 && j == 1) return "#fddba2";
                if (i == 1 && j == 1) return "#faa519";
                if (i == 2 && j == 1) return "#c87e04";
                if (i == 0 && j == 2) return "#9dd58a";
                if (i == 1 && j == 2) return "#5fb441";
                if (i == 2 && j == 2) return "#468631";
                return "gray";
            })
            .tooltip({
                textFunction: function (rg, map) {
                    const buf = [];
                    //region name
                    if (rg.properties.id) {
                        //name and code
                        buf.push("<b>" + rg.properties.na + "</b> (" + rg.properties.id + ") <br>");
                    } else {
                        //region name
                        buf.push("<b>" + rg.properties.na + "</b><br>");
                    }

                    //URT value
                    const sv2 = map.statData("v2").get(rg.properties.id);
                    if (!sv2 || (sv2.value != 0 && !sv2.value)) buf.push(map.noDataText_);
                    else {
                        buf.push(
                            sv2.value == 1 ? "Predominantly urban region" : sv2.value == 2 ? "Intermediate region" : "Predominantly rural region"
                        );
                    }

                    buf.push("<br>");

                    //stat value
                    const sv1 = map.statData("v1").get(rg.properties.id);
                    if (!sv1 || (sv1.value != 0 && !sv1.value)) buf.push(map.noDataText_);
                    else {
                        buf.push(sv1.value);
                        //unit 1
                        const unit1 = map.statData("v1").unitText();
                        if (unit1) buf.push(" " + unit1);
                    }


                    return buf.join("");
                }
            })
            //.legend({ boxFill: "none", squareSize: 80, label1: "Unemployment", label2: "Population", x: 10, y: 140, })
            .showSourceLink(false)
            .cntbnStroke({ 0: "#777", 1: "#777", 2: "#777", 3: "#777", oth: "none", co: "none" })
            .nutsbnStroke({ 0: "#666", 1: "#777", 2: "#777", 3: "#999", oth: "none", co: "#1f78b4" })
            .coastalMarginColor("lightgray")
        //.seaFillStyle("#d3dee8")
        //.drawCoastalMargin(false)
        .zoomExtent([1, 3])

        map.build();

    </script>

</body>

</html>